!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("mapbox-gl")):"function"==typeof define&&define.amd?define(["exports","mapbox-gl"],e):e((t=t||self).bundle={},t.mapboxgl)}(this,(function(t,e){"use strict";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function o(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}function s(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function a(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function u(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?a(Object(n),!0).forEach((function(e){s(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&h(t,e)}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function h(t,e){return(h=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function d(t,e){if(null==t)return{};var n,i,r=function(t,e){if(null==t)return{};var n,i,r={},o=Object.keys(t);for(i=0;i<o.length;i++)n=o[i],e.indexOf(n)>=0||(r[n]=t[n]);return r}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(i=0;i<o.length;i++)n=o[i],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function f(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function p(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?f(t):e}function v(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=c(t);if(e){var r=c(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return p(this,n)}}function m(t,e,n){return(m="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=c(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function y(t,e){return e||(e=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}function g(t){return function(t){if(Array.isArray(t))return A(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||b(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(t,e){if(t){if("string"==typeof t)return A(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?A(t,e):void 0}}function A(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function k(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=b(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return s=t.done,t},e:function(t){a=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function w(t){for(var e=[],n=0;n<t;n++)e.push(0);return e}function _(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function x(t){return t.reduce((function(t,e){return t+e}),0)}function E(t){return("0"+t.toString(16)).substr(-2)}function M(t){var e=new Uint8Array((t||40)/2);return(window.crypto?window.crypto:window.msCrypto).getRandomValues(e),Array.from(e,E).join("")}function S(t,e){t.forEach((function(t){e[t]=e[t].bind(e)}))}e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e;var O,N={selectTool:function(t,e){return u(u({},t),{},{activeTool:e.id})},openDropdownMenu:function(t){return u(u({},t),{},{dropdownMenuOpen:!0})},closeDropdownMenu:function(t){return u(u({},t),{},{dropdownMenuOpen:!1})}},P=function(t){var e={},n=function(t){e[t]=function(e){return u(u({},e),{},{type:t})}};for(var i in t)n(i);return e}(N),T=function(t){return function(e,n){return t.hasOwnProperty(n.type)?t[n.type](e,n):e}}(N),V=(O={toolbar:T},function(t,e){var n=!1,i={};for(var r in O)i[r]=O[r](t[r],e),n=n||i[r]!==t[r];return n?i:t}),B=new WeakMap,F=function(t){return"function"==typeof t&&B.has(t)},I="undefined"!=typeof window&&null!=window.customElements&&void 0!==window.customElements.polyfillWrapFlushCallback,C=function(t,e){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e!==n;){var i=e.nextSibling;t.removeChild(e),e=i}},j={},L={},R="{{lit-".concat(String(Math.random()).slice(2),"}}"),H="\x3c!--".concat(R,"--\x3e"),D=new RegExp("".concat(R,"|").concat(H)),U=function t(e,n){i(this,t),this.parts=[],this.element=n;for(var r=[],o=[],s=document.createTreeWalker(n.content,133,null,!1),a=0,u=-1,l=0,c=e.strings,h=e.values.length;l<h;){var d=s.nextNode();if(null!==d){if(u++,1===d.nodeType){if(d.hasAttributes()){for(var f=d.attributes,p=f.length,v=0,m=0;m<p;m++)Q(f[m].name,"$lit$")&&v++;for(;v-- >0;){var y=c[l],g=G.exec(y)[2],b=g.toLowerCase()+"$lit$",A=d.getAttribute(b);d.removeAttribute(b);var k=A.split(D);this.parts.push({type:"attribute",index:u,name:g,strings:k}),l+=k.length-1}}"TEMPLATE"===d.tagName&&(o.push(d),s.currentNode=d.content)}else if(3===d.nodeType){var w=d.data;if(w.indexOf(R)>=0){for(var _=d.parentNode,x=w.split(D),E=x.length-1,M=0;M<E;M++){var S=void 0,O=x[M];if(""===O)S=Y();else{var N=G.exec(O);null!==N&&Q(N[2],"$lit$")&&(O=O.slice(0,N.index)+N[1]+N[2].slice(0,-"$lit$".length)+N[3]),S=document.createTextNode(O)}_.insertBefore(S,d),this.parts.push({type:"node",index:++u})}""===x[E]?(_.insertBefore(Y(),d),r.push(d)):d.data=x[E],l+=E}}else if(8===d.nodeType)if(d.data===R){var P=d.parentNode;null!==d.previousSibling&&u!==a||(u++,P.insertBefore(Y(),d)),a=u,this.parts.push({type:"node",index:u}),null===d.nextSibling?d.data="":(r.push(d),u--),l++}else for(var T=-1;-1!==(T=d.data.indexOf(R,T+1));)this.parts.push({type:"node",index:-1}),l++}else s.currentNode=o.pop()}for(var V=0,B=r;V<B.length;V++){var F=B[V];F.parentNode.removeChild(F)}},Q=function(t,e){var n=t.length-e.length;return n>=0&&t.slice(n)===e},z=function(t){return-1!==t.index},Y=function(){return document.createComment("")},G=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F "'>=/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/,K=function(){function t(e,n,r){i(this,t),this.__parts=[],this.template=e,this.processor=n,this.options=r}return o(t,[{key:"update",value:function(t){var e,n=0,i=k(this.__parts);try{for(i.s();!(e=i.n()).done;){var r=e.value;void 0!==r&&r.setValue(t[n]),n++}}catch(t){i.e(t)}finally{i.f()}var o,s=k(this.__parts);try{for(s.s();!(o=s.n()).done;){var a=o.value;void 0!==a&&a.commit()}}catch(t){s.e(t)}finally{s.f()}}},{key:"_clone",value:function(){for(var t,e=I?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),n=[],i=this.template.parts,r=document.createTreeWalker(e,133,null,!1),o=0,s=0,a=r.nextNode();o<i.length;)if(t=i[o],z(t)){for(;s<t.index;)s++,"TEMPLATE"===a.nodeName&&(n.push(a),r.currentNode=a.content),null===(a=r.nextNode())&&(r.currentNode=n.pop(),a=r.nextNode());if("node"===t.type){var u=this.processor.handleTextExpression(this.options);u.insertAfterNode(a.previousSibling),this.__parts.push(u)}else{var l;(l=this.__parts).push.apply(l,g(this.processor.handleAttributeExpressions(a,t.name,t.strings,this.options)))}o++}else this.__parts.push(void 0),o++;return I&&(document.adoptNode(e),customElements.upgrade(e)),e}}]),t}(),J=" ".concat(R," "),Z=function(){function t(e,n,r,o){i(this,t),this.strings=e,this.values=n,this.type=r,this.processor=o}return o(t,[{key:"getHTML",value:function(){for(var t=this.strings.length-1,e="",n=!1,i=0;i<t;i++){var r=this.strings[i],o=r.lastIndexOf("\x3c!--");n=(o>-1||n)&&-1===r.indexOf("--\x3e",o+1);var s=G.exec(r);e+=null===s?r+(n?J:H):r.substr(0,s.index)+s[1]+s[2]+"$lit$"+s[3]+R}return e+=this.strings[t]}},{key:"getTemplateElement",value:function(){var t=document.createElement("template");return t.innerHTML=this.getHTML(),t}}]),t}(),W=function(t){return null===t||!("object"===n(t)||"function"==typeof t)},X=function(t){return Array.isArray(t)||!(!t||!t[Symbol.iterator])},q=function(){function t(e,n,r){i(this,t),this.dirty=!0,this.element=e,this.name=n,this.strings=r,this.parts=[];for(var o=0;o<r.length-1;o++)this.parts[o]=this._createPart()}return o(t,[{key:"_createPart",value:function(){return new $(this)}},{key:"_getValue",value:function(){for(var t=this.strings,e=t.length-1,n="",i=0;i<e;i++){n+=t[i];var r=this.parts[i];if(void 0!==r){var o=r.value;if(W(o)||!X(o))n+="string"==typeof o?o:String(o);else{var s,a=k(o);try{for(a.s();!(s=a.n()).done;){var u=s.value;n+="string"==typeof u?u:String(u)}}catch(t){a.e(t)}finally{a.f()}}}}return n+=t[e]}},{key:"commit",value:function(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}}]),t}(),$=function(){function t(e){i(this,t),this.value=void 0,this.committer=e}return o(t,[{key:"setValue",value:function(t){t===j||W(t)&&t===this.value||(this.value=t,F(t)||(this.committer.dirty=!0))}},{key:"commit",value:function(){for(;F(this.value);){var t=this.value;this.value=j,t(this)}this.value!==j&&this.committer.commit()}}]),t}(),tt=function(){function t(e){i(this,t),this.value=void 0,this.__pendingValue=void 0,this.options=e}return o(t,[{key:"appendInto",value:function(t){this.startNode=t.appendChild(Y()),this.endNode=t.appendChild(Y())}},{key:"insertAfterNode",value:function(t){this.startNode=t,this.endNode=t.nextSibling}},{key:"appendIntoPart",value:function(t){t.__insert(this.startNode=Y()),t.__insert(this.endNode=Y())}},{key:"insertAfterPart",value:function(t){t.__insert(this.startNode=Y()),this.endNode=t.endNode,t.endNode=this.startNode}},{key:"setValue",value:function(t){this.__pendingValue=t}},{key:"commit",value:function(){if(null!==this.startNode.parentNode){for(;F(this.__pendingValue);){var t=this.__pendingValue;this.__pendingValue=j,t(this)}var e=this.__pendingValue;e!==j&&(W(e)?e!==this.value&&this.__commitText(e):e instanceof Z?this.__commitTemplateResult(e):e instanceof Node?this.__commitNode(e):X(e)?this.__commitIterable(e):e===L?(this.value=L,this.clear()):this.__commitText(e))}}},{key:"__insert",value:function(t){this.endNode.parentNode.insertBefore(t,this.endNode)}},{key:"__commitNode",value:function(t){this.value!==t&&(this.clear(),this.__insert(t),this.value=t)}},{key:"__commitText",value:function(t){var e=this.startNode.nextSibling,n="string"==typeof(t=null==t?"":t)?t:String(t);e===this.endNode.previousSibling&&3===e.nodeType?e.data=n:this.__commitNode(document.createTextNode(n)),this.value=t}},{key:"__commitTemplateResult",value:function(t){var e=this.options.templateFactory(t);if(this.value instanceof K&&this.value.template===e)this.value.update(t.values);else{var n=new K(e,t.processor,this.options),i=n._clone();n.update(t.values),this.__commitNode(i),this.value=n}}},{key:"__commitIterable",value:function(e){Array.isArray(this.value)||(this.value=[],this.clear());var n,i,r=this.value,o=0,s=k(e);try{for(s.s();!(i=s.n()).done;){var a=i.value;void 0===(n=r[o])&&(n=new t(this.options),r.push(n),0===o?n.appendIntoPart(this):n.insertAfterPart(r[o-1])),n.setValue(a),n.commit(),o++}}catch(t){s.e(t)}finally{s.f()}o<r.length&&(r.length=o,this.clear(n&&n.endNode))}},{key:"clear",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startNode;C(this.startNode.parentNode,t.nextSibling,this.endNode)}}]),t}(),et=function(){function t(e,n,r){if(i(this,t),this.value=void 0,this.__pendingValue=void 0,2!==r.length||""!==r[0]||""!==r[1])throw new Error("Boolean attributes can only contain a single expression");this.element=e,this.name=n,this.strings=r}return o(t,[{key:"setValue",value:function(t){this.__pendingValue=t}},{key:"commit",value:function(){for(;F(this.__pendingValue);){var t=this.__pendingValue;this.__pendingValue=j,t(this)}if(this.__pendingValue!==j){var e=!!this.__pendingValue;this.value!==e&&(e?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name),this.value=e),this.__pendingValue=j}}}]),t}(),nt=function(t){l(n,t);var e=v(n);function n(t,r,o){var s;return i(this,n),(s=e.call(this,t,r,o)).single=2===o.length&&""===o[0]&&""===o[1],s}return o(n,[{key:"_createPart",value:function(){return new it(this)}},{key:"_getValue",value:function(){return this.single?this.parts[0].value:m(c(n.prototype),"_getValue",this).call(this)}},{key:"commit",value:function(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}}]),n}(q),it=function(t){l(n,t);var e=v(n);function n(){return i(this,n),e.apply(this,arguments)}return n}($),rt=!1;!function(){try{var t={get capture(){return rt=!0,!1}};window.addEventListener("test",t,t),window.removeEventListener("test",t,t)}catch(t){}}();var ot=function(){function t(e,n,r){var o=this;i(this,t),this.value=void 0,this.__pendingValue=void 0,this.element=e,this.eventName=n,this.eventContext=r,this.__boundHandleEvent=function(t){return o.handleEvent(t)}}return o(t,[{key:"setValue",value:function(t){this.__pendingValue=t}},{key:"commit",value:function(){for(;F(this.__pendingValue);){var t=this.__pendingValue;this.__pendingValue=j,t(this)}if(this.__pendingValue!==j){var e=this.__pendingValue,n=this.value,i=null==e||null!=n&&(e.capture!==n.capture||e.once!==n.once||e.passive!==n.passive),r=null!=e&&(null==n||i);i&&this.element.removeEventListener(this.eventName,this.__boundHandleEvent,this.__options),r&&(this.__options=st(e),this.element.addEventListener(this.eventName,this.__boundHandleEvent,this.__options)),this.value=e,this.__pendingValue=j}}},{key:"handleEvent",value:function(t){"function"==typeof this.value?this.value.call(this.eventContext||this.element,t):this.value.handleEvent(t)}}]),t}(),st=function(t){return t&&(rt?{capture:t.capture,passive:t.passive,once:t.once}:t.capture)},at=new(function(){function t(){i(this,t)}return o(t,[{key:"handleAttributeExpressions",value:function(t,e,n,i){var r=e[0];return"."===r?new nt(t,e.slice(1),n).parts:"@"===r?[new ot(t,e.slice(1),i.eventContext)]:"?"===r?[new et(t,e.slice(1),n)]:new q(t,e,n).parts}},{key:"handleTextExpression",value:function(t){return new tt(t)}}]),t}());
/**
   * @license
   * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
   * This code may only be used under the BSD style license found at
   * http://polymer.github.io/LICENSE.txt
   * The complete set of authors may be found at
   * http://polymer.github.io/AUTHORS.txt
   * The complete set of contributors may be found at
   * http://polymer.github.io/CONTRIBUTORS.txt
   * Code distributed by Google as part of the polymer project is also
   * subject to an additional IP rights grant found at
   * http://polymer.github.io/PATENTS.txt
   */
function ut(t){var e=lt.get(t.type);void 0===e&&(e={stringsArray:new WeakMap,keyString:new Map},lt.set(t.type,e));var n=e.stringsArray.get(t.strings);if(void 0!==n)return n;var i=t.strings.join(R);return void 0===(n=e.keyString.get(i))&&(n=new U(t,t.getTemplateElement()),e.keyString.set(i,n)),e.stringsArray.set(t.strings,n),n}var lt=new Map,ct=new WeakMap,ht=function(t,e,n){var i=ct.get(e);void 0===i&&(C(e,e.firstChild),ct.set(e,i=new tt(Object.assign({templateFactory:ut},n))),i.appendInto(e)),i.setValue(t),i.commit()};
/**
   * @license
   * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
   * This code may only be used under the BSD style license found at
   * http://polymer.github.io/LICENSE.txt
   * The complete set of authors may be found at
   * http://polymer.github.io/AUTHORS.txt
   * The complete set of contributors may be found at
   * http://polymer.github.io/CONTRIBUTORS.txt
   * Code distributed by Google as part of the polymer project is also
   * subject to an additional IP rights grant found at
   * http://polymer.github.io/PATENTS.txt
   */
/**
   * @license
   * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
   * This code may only be used under the BSD style license found at
   * http://polymer.github.io/LICENSE.txt
   * The complete set of authors may be found at
   * http://polymer.github.io/AUTHORS.txt
   * The complete set of contributors may be found at
   * http://polymer.github.io/CONTRIBUTORS.txt
   * Code distributed by Google as part of the polymer project is also
   * subject to an additional IP rights grant found at
   * http://polymer.github.io/PATENTS.txt
   */
"undefined"!=typeof window&&(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.2.1");var dt=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return new Z(t,n,"html",at)},ft=["#0099cd","#ffca5d","#00cd99","#99cd00","#cd0099","#9900cd","#8dd3c7","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#bc80bd","#ccebc5","#ffed6f","#ffffb3","#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#b15928","#64ffda","#00B8D4","#A1887F","#76FF03","#DCE775","#B388FF","#FF80AB","#D81B60","#26A69A","#FFEA00","#6200EA"];ft.push.apply(ft,g(ft.map((function(t){return mt(t,-.3)}))));var pt=ft,vt=pt.map((function(t){return mt(t,-.3)}));function mt(t,e){(t=String(t).replace(/[^0-9a-f]/gi,"")).length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),e=e||0;var n,i,r="#";for(i=0;i<3;i++)n=parseInt(t.substr(2*i,2),16),r+=("00"+(n=Math.round(Math.min(Math.max(0,n+n*e),255)).toString(16))).substr(n.length);return r}var yt=pt.map((function(t,e){return{id:e,name:t,hex:t,hoverHex:vt[e]}}));function gt(t){var e=["match",["feature-state","color"]].concat(g(t.map((function(t){return[t.id,t.color]})).reduce((function(t,e){return[].concat(g(t),g(e))}))),["rgba(0, 0, 0, 0)"]);return["case",["boolean",["feature-state","hover"],!1],["match",["feature-state","color"]].concat(g(t.map((function(t){return[t.id,t.hoverColor]})).reduce((function(t,e){return[].concat(g(t),g(e))}))),["#aaaaaa"]),e]}var bt={"line-color":"#777777","line-width":["interpolate",["linear"],["zoom"],0,0,7,1],"line-opacity":.3};u(u({},bt),{},{"line-color":["case",["==",["feature-state","color"],null],"#ff4f49",bt["line-color"]],"line-width":["case",["==",["feature-state","color"],null],4,1],"line-opacity":["case",["==",["feature-state","color"],null],.8,.3]});function At(t,e){var n=function(t){for(var e=0;e<t.length;e++)if(t[e].id.includes("label"))return t[e].id}(t.getStyle().layers);t.addLayer(e,n)}var kt=function(){function t(e,n,r){var o;i(this,t),this.map=e,this.id=n.id,this.sourceId="string"==typeof(o=n.source)||o instanceof String?n.source:n.id,this.type=n.type,this.sourceLayer=n["source-layer"],r?r(e,n):e.addLayer(n),this.getFeature=this.getFeature.bind(this)}return o(t,[{key:"setOpacity",value:function(t){this.setPaintProperty("".concat(this.type,"-opacity"),t)}},{key:"setColor",value:function(t){this.setPaintProperty("".concat(this.type,"-color"),t)}},{key:"getColor",value:function(){return this.getPaintProperty("".concat(this.type,"-color"))}},{key:"setPaintProperties",value:function(t){for(var e in t)this.setPaintProperty(e,t[e])}},{key:"setFeatureState",value:function(t,e){this.map.setFeatureState({source:this.sourceId,sourceLayer:this.sourceLayer,id:t},e)}},{key:"setPaintProperty",value:function(t,e){this.map.setPaintProperty(this.id,t,e)}},{key:"getPaintProperty",value:function(t){return this.map.getPaintProperty(this.id,t)}},{key:"getFeatureState",value:function(t){return this.map.getFeatureState({source:this.sourceId,sourceLayer:this.sourceLayer,id:t})}},{key:"getFeature",value:function(t){return this.map.querySourceFeatures(this.sourceId,{sourceLayer:this.sourceLayer,filter:["==",["id"],t]})[0]}},{key:"queryRenderedFeatures",value:function(){return this.map.queryRenderedFeatures(null,{layers:[this.id]})}},{key:"querySourceFeatures",value:function(){return this.map.querySourceFeatures(this.sourceId,{sourceLayer:this.sourceLayer})}},{key:"getAssignment",value:function(t){return this.getFeatureState(t).color}},{key:"setAssignment",value:function(t,e){this.setFeatureState(t.id,u(u({},t.state),{},{color:e}))}},{key:"on",value:function(t){for(var e,n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];(e=this.map).on.apply(e,[t,this.id].concat(i))}},{key:"off",value:function(t){for(var e,n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];(e=this.map).off.apply(e,[t,this.id].concat(i))}},{key:"untilSourceLoaded",value:function(t){var e=this;if(this.map.isSourceLoaded(this.sourceId))return t();this.map.on("sourcedata",(function n(){return t((function(){return e.map.off("sourcedata",n)}))}))}}]),t}(),wt=function t(n,r,o){i(this,t),this.map=new e.Map(u({container:n,style:o,attributionControl:!1,minZoom:10,pitchWithRotate:!1,dragPan:!0,touchZoomRotate:!0},r)),this.nav=new e.NavigationControl,this.map.addControl(this.nav,"top-left"),this.mapboxgl=e};function _t(t,e,n,i){var r,o=k(n);try{for(o.s();!(r=o.n()).done;){var s=r.value;t.addSource(s.sourceLayer,s.source)}}catch(t){o.e(t)}finally{o.f()}var a=function(t,e,n,i){return{units:new kt(t,{id:n.sourceLayer,source:n.sourceLayer,"source-layer":n.sourceLayer,type:"fill",paint:{"fill-color":gt(e),"fill-opacity":.8}},i),unitsBorders:new kt(t,{id:"units-borders",type:"line",source:n.sourceLayer,"source-layer":n.sourceLayer,paint:bt},i)}}(t,e,n.find((function(t){return"fill"===t.type})),i);return{units:a.units,unitsBorders:a.unitsBorders,points:!1}}var xt=function(){function t(e){var n=e.key,r=e.name;i(this,t),this.key=n,this.name=r}return o(t,[{key:"getValue",value:function(t){if(void 0!==t.properties)return t.properties[this.key]}}]),t}();function Et(){var t=y(['\n            <span class="part-number" style="background: ','">\n                ',"\n            </span>\n        "]);return Et=function(){return t},t}var Mt=function(){function t(e,n,r,o){var s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];i(this,t),this.id=e,this.noun=n,this.displayNumber=r,this.color=o.hex,this.hoverColor=o.hoverHex,this.visible=s}return o(t,[{key:"updateDescription",value:function(t){var e=t.name,n=t.description;this.name=e,this.description=n}},{key:"serialize",value:function(){return{id:this.id,displayNumber:this.displayNumber,name:this.name,description:this.description}}},{key:"renderLabel",value:function(){return dt(Et(),this.color,this.displayNumber)}}]),t}(),St=function(){function t(e){i(this,t),this.name=e.name,this.key=e.key,this.sum=e.sum,this.min=e.min,this.max=e.max,this.getValue=this.getValue.bind(this),this.formatValue=this.formatValue.bind(this),this.asMapboxExpression=this.asMapboxExpression.bind(this)}return o(t,[{key:"getValue",value:function(t){return parseFloat(t.properties[this.key])}},{key:"formatValue",value:function(t){return _(this.getValue(t))}},{key:"asMapboxExpression",value:function(){return["to-number",["get",this.key]]}}]),t}(),Ot=function(){function t(e){var n=e.columns,r=e.columnSet,o=e.parts;i(this,t),this.columns=n,this.columnSet=r,this.data=w(o.length),this.sum=x(this.columns.map((function(t){return t.sum}))),this.min=Math.min.apply(Math,g(this.columns.map((function(t){return t.min})))),this.max=Math.max.apply(Math,g(this.columns.map((function(t){return t.max})))),this.getValue=this.getValue.bind(this),this.formatValue=this.formatValue.bind(this),this.asMapboxExpression=this.asMapboxExpression.bind(this),this.update=this.update.bind(this)}return o(t,[{key:"update",value:function(t,e){null!=e&&(this.data[e]+=this.getValue(t)),void 0!==t.state&&void 0!==t.state.color&&null!==t.state.color&&(this.data[t.state.color]-=this.getValue(t))}},{key:"getValue",value:function(t){return x(this.columns.map((function(e){return e.getValue(t)})))}},{key:"formatValue",value:function(t){return _(this.getValue(t))}},{key:"asMapboxExpression",value:function(){var t=["+"];return this.columns.forEach((function(e){t.push(e.asMapboxExpression())})),t}},{key:"total",get:function(){return this.columnSet.total}}]),t}(),Nt=function(t){l(n,t);var e=v(n);function n(t){var r,o=t.columnSet,s=t.parts,a=d(t,["columnSet","parts"]);return i(this,n),(r=e.call(this,a)).columnSet=o,r.data=w(s.length),r.update=r.update.bind(f(r)),r.fractionAsMapboxExpression=r.fractionAsMapboxExpression.bind(f(r)),r.getFractionFromFeature=r.getFractionFromFeature.bind(f(r)),r.getFractionInPart=r.getFractionInPart.bind(f(r)),r.getOverallFraction=r.getOverallFraction.bind(f(r)),r}return o(n,[{key:"getFractionFromFeature",value:function(t){return this.getValue(t)/this.total.getValue(t)}},{key:"getFractionInPart",value:function(t){var e=this.total.data[t];return e>0?this.data[t]/e:0}},{key:"getOverallFraction",value:function(){var t=this.total.sum;return t>0?this.sum/t:0}},{key:"fractionAsMapboxExpression",value:function(){return t=this.asMapboxExpression(),["case",[">",e=this.total.asMapboxExpression(),0],["/",t,e],0];var t,e}},{key:"update",value:function(t,e){null!=e&&(this.data[e]+=this.getValue(t)),void 0!==t.state&&void 0!==t.state.color&&null!==t.state.color&&(this.data[t.state.color]-=this.getValue(t))}},{key:"getAbbreviation",value:function(){return Pt.hasOwnProperty(this.key)?Pt[this.key]:this.name.split(" ")[0]}},{key:"total",get:function(){return this.columnSet.total}}]),n}(St),Pt={NH_WHITE:"White",NH_BLACK:"Black",HISP:"Hispanic",NH_ASIAN:"Asian",NH_AMIN:"Native",NH_NHPI:"NHPI",NH_2MORE:"2+",NH_OTHER:"Other",WVAP:"WVAP",BVAP:"BVAP",HVAP:"HVAP",AMINVAP:"Native VAP",NHPIVAP:"NHPI VAP",ASIANVAP:"AVAP",OTHERVAP:"Other VAP",OTHVAP:"Other VAP","2MOREVAP":"2+ VAP"};function Tt(t){var e,n=k(t);try{for(n.s();!(e=n.n()).done;){if("number"!=typeof e.value.sum)return!1}}catch(t){n.e(t)}finally{n.f()}return!0}function Vt(t){return t.sort((function(t,e){return e.sum-t.sum}))}var Bt=function(t){l(n,t);var e=v(n);function n(t){var r,o,s,a=t.name,u=t.subgroups,l=t.total,c=t.parts;return i(this,n),(r=e.call(this,{subgroups:u,total:l,parts:c})).name=a,r.ideal=r.total.sum/c.length,r.formattedIdeal=_((o=r.ideal,s=2,Math.round(o*Math.pow(10,s))/Math.pow(10,s))),r.update=r.update.bind(f(r)),r.deviations=r.deviations.bind(f(r)),r}return o(n,[{key:"deviations",value:function(){var t=this;return this.total.data.map((function(e){return(e-t.ideal)/t.ideal}))}},{key:"indicesOfMajorSubgroups",value:function(){var t=this;return this.subgroups.map((function(t,e){return e})).sort((function(e,n){return t.subgroups[n].sum-t.subgroups[e].sum})).slice(0,3)}}]),n}(function(){function t(e){var n=this,r=e.subgroups,o=e.total,s=e.parts,a=e.type,l=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];i(this,t),this.type=a,this.subgroups=r?r.map((function(t){return new Nt(u(u({},t),{},{parts:s,columnSet:n}))})):[],l&&Tt(this.subgroups)&&(this.subgroups=Vt(this.subgroups)),this.total=null!=o?new Nt(u(u({},o),{},{parts:s,columnSet:this})):new Ot({columns:this.subgroups,columnSet:this,parts:s}),this.update=this.update.bind(this)}return o(t,[{key:"update",value:function(t,e){this.subgroups.forEach((function(n){return n.update(t,e)})),this.total.update(t,e)}},{key:"columns",get:function(){return[this.total].concat(g(this.subgroups))}}]),t}());function Ft(t,e){t.population=function(t,e){var n=t.columnSets.find((function(t){return"Population"===t.name}));return new Bt(u(u({},n),{},{parts:e}))}(e,t.parts),t.vap=function(t,e){var n=t.columnSets.find((function(t){return"Voting Age Population"===t.name}));return n?new Bt(u(u({},n),{},{parts:e})):null}(e,t.parts),t.columns=[t.population.total].concat(g(t.population.subgroups)),t.vap&&(t.columns=[].concat(g(t.columns),g(t.vap.subgroups),[t.vap.total]));var n=[t.population];return t.vap&&n.push(t.vap),n}var It=function(){function t(e){var n=e.id,r=e.problem,o=e.idColumn,s=e.parts;if(i(this,t),this.id=n||M(8),this.problem=r,this.assignment={},this.parts=function(t){for(var e=t.name||"District",n=[],i=0;i<t.numberOfParts;i++){var r=i%yt.length;n[i]=new Mt(i,e,i+1,yt[r])}return n.length>yt.length&&n.slice(1).forEach((function(t){t.visible=!1})),n}(r),s)for(var a=0;a<s.length;a++)this.parts[a].updateDescription(s[a]);"multimember"!==r.type&&"community"!==r.type||this.parts.slice(1).forEach((function(t){t.visible=!1})),"community"===r.type&&this.parts.forEach((function(t){t.name||(t.name="Community ".concat(t.displayNumber))})),this.idColumn=o}return o(t,[{key:"update",value:function(t,e){this.assignment[this.idColumn.getValue(t)]=e}},{key:"serialize",value:function(){return{name:this.name,description:this.description,assignment:this.assignment,id:this.id,idColumn:{key:this.idColumn.key,name:this.idColumn.name},problem:this.problem,parts:this.parts.filter((function(t){return t.visible})).map((function(t){return t.serialize()}))}}}]),t}(),Ct=function(){function t(e,n){var r=n.place,o=n.problem,s=n.id,a=n.units,l=d(n,["place","problem","id","units"]);i(this,t),this.unitsRecord=a,this.place=r,this.idColumn=new xt(a.idColumn),a.hasOwnProperty("nameColumn")&&(this.nameColumn=new xt(a.nameColumn)),this.plan=new It(u(u({id:s,problem:o},l),{},{idColumn:this.idColumn})),this.initializeMapState(e,a,At),this.columnSets=Ft(this,a),this.subscribers=[],this.update=this.update.bind(this),this.render=this.render.bind(this)}return o(t,[{key:"initializeMapState",value:function(t,e,n){var i,r=k(e.tilesets);try{for(r.s();!(i=r.n()).done;){var o=i.value;o.source.promoteId={},o.source.promoteId[o.sourceLayer]=e.idColumn.key}}catch(t){r.e(t)}finally{r.f()}var s=_t(t,this.parts,e.tilesets,n),a=s.units,u=s.unitsBorders,l=s.points;this.units=a,this.unitsBorders=u,this.layers=[a,l],this.map=t}},{key:"update",value:function(t,e){this.columnSets.forEach((function(n){return n.update(t,e)})),this.plan.update(t,e)}},{key:"serialize",value:function(){return u(u({},this.plan.serialize()),{},{placeId:this.place.id,units:this.unitsRecord})}},{key:"subscribe",value:function(t){this.subscribers.push(t),this.render()}},{key:"render",value:function(){var t,e=k(this.subscribers);try{for(e.s();!(t=e.n()).done;){(0,t.value)()}}catch(t){e.e(t)}finally{e.f()}}},{key:"hasExpectedData",value:function(t){if(void 0===t||void 0===t.properties)return!1;var e,n=k(this.columns);try{for(n.s();!(e=n.n()).done;){var i=e.value;if(void 0===t.properties[i.key])return!1}}catch(t){n.e(t)}finally{n.f()}return!0}},{key:"activeParts",get:function(){return this.plan.parts.filter((function(t){return t.visible}))}},{key:"parts",get:function(){return this.plan.parts}},{key:"problem",get:function(){return this.plan.problem}}]),t}();function jt(){var t=y(['\n    <div class="ui-option">\n        <legend class="ui-label ui-label--row">\n            ','\n        </legend>\n        <div class="slider-container">\n            <input\n                class="slider"\n                type="range"\n                value="','"\n                min="1"\n                max="40"\n                @change=','\n            />\n            <input\n                class="slider-value"\n                type="number"\n                value="','"\n                min="1"\n                max="40"\n                @change=',"\n            />\n        </div>\n    </div>\n"]);return jt=function(){return t},t}var Lt=function(t,e,n){return dt(jt(),n?n.title:"Brush Size",t,e,t,e)};function Rt(){var t=y(['\n            <div class="icon-list__item" title="','">\n                <label>','</label>\n                <input\n                    type="radio"\n                    id="tool-','"\n                    name="tool"\n                    value="','"\n                    @change=',"\n                    ?checked=",'\n                />\n                <div class="icon-list__item__radio"></div>\n                ',"\n            </div>\n        "]);return Rt=function(){return t},t}var Ht=function(){function t(e,n,r){i(this,t),this.id=e,this.name=n,this.icon=r,this.active=!1}return o(t,[{key:"activate",value:function(){this.active=!0}},{key:"deactivate",value:function(){this.active=!1}},{key:"render",value:function(t){var e=this;return dt(Rt(),this.name,this.name,this.id,this.id,(function(){return t(e.id)}),this.active,this.icon)}}]),t}();function Dt(){var t=y(["",""]);return Dt=function(){return t},t}function Ut(){var t=y(['<img src="','" alt="Brush" \n            style="display: inline-block; height: 26px !important; z-index: 100;"></img>']);return Ut=function(){return t},t}var Qt=function(t){l(n,t);var e=v(n);function n(t,r){var o;i(this,n);var s=dt(Ut(),"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABICAYAAABV7bNHAAABXUlEQVR4Ae3ZEXTDYBiF4UGhUBgMCoNBoVAYDmrDQGFQrNNwfgrDwnBQKASCxcEgEJxTITAMFAPfXgj1bH/W5Kev957z+Dmv3itN0zRN0zRNu6QNsUSBPRJozUbIYSc2OJ3ihCMpTjiS4oQjKU5Yojhhe8UJKxQnbKk4f8swgJMpjuIojuIojuIojuIojuIojuIojuIojuIojuI43afihPeEOlocRQrHUaRwHEUKx1EkV3EesEGBQyPHGrMOkdzEmeAD1iLFuD2SrzhzVLB/KjFtiZR6iTPFEXamEmO4XwHrKIXrJbCeZnC7HaynNdyuhPWUw+0sggNc7hYWQQmXe4RFUMDl3mERZHC3e9SwCFZwtTm+YRHUuPEQZYQ5UlhEb3CxDBZZhbEumt/VSOBqA+xgETzD7VaoYB0csYD7XeP1zFBb3OGiNsQCW3yhhjVK5HjBBJqmaZqmaZrmcz/pIiIIU7ugBgAAAABJRU5ErkJggg==");return(o=e.call(this,"brush","Draw",s)).brush=t,o.colors=r,o.options=new zt(t,r),o}return o(n,[{key:"activate",value:function(){m(c(n.prototype),"activate",this).call(this),this.brush.activate()}},{key:"deactivate",value:function(){m(c(n.prototype),"deactivate",this).call(this),this.brush.deactivate()}}]),n}(Ht),zt=function(){function t(e,n,r){i(this,t),this.brush=e,this.colors=n,this.renderToolbar=r,this.changeRadius=this.changeRadius.bind(this)}return o(t,[{key:"changeRadius",value:function(t){t.stopPropagation();var e=parseInt(t.target.value);this.brush.radius!=e&&(this.brush.radius=e),this.renderToolbar()}},{key:"render",value:function(){return dt(Dt(),Lt(this.brush.radius,this.changeRadius))}}]),t}();function Yt(){var t=y(["\n            ","\n        "]);return Yt=function(){return t},t}function Gt(){var t=y(['<img src="','" alt="Erase" \n            style="display: inline-block; height: 26px !important; z-index: 100;"></img>']);return Gt=function(){return t},t}var Kt=function(t){l(n,t);var e=v(n);function n(t){var r;i(this,n);var o=dt(Gt(),"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAA7EAAAOxAGVKw4bAAABBElEQVRo3u3Yuw7BYBiH8WdmcLorXIxuRjtuSWKjTiM3YBWjSQ3yJY00aL9TX94n+UbJ7y/apkDTNO2fagJz4ARcgSUwjI36tjaQAtnLuQNJbNynWsC6AJ8/49hIG3xtR5TB125EFXxtRtjgo49wgY82wiU++Agf+GAj2sDGE94cbw+7EHjzxB5IxZuzkozPgJtkfAacJeMzYCoZnwING7zP+/ynswe6ile84uXgezb4JsX/HoQ4W6BjgweYScYDHCPgD1j+bPJdAuN3rr5500IyHqDP8+UhBN7qVvmuRDLeNPKEL7pgJyU+H3WELb70AJcjXOArDXAxwhW+8gBN0zTtN3sAFI5CX1O33XwAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjAtMDgtMDRUMDI6NDg6NDkrMDA6MDADjPrkAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIwLTA4LTA0VDAyOjQ4OjQ5KzAwOjAwctFCWAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAASUVORK5CYII=");return(r=e.call(this,"eraser","Erase",o)).brush=t,r.options=new Jt(t),r}return o(n,[{key:"activate",value:function(){m(c(n.prototype),"activate",this).call(this),this.brush.activate(),this.brush.startErasing()}},{key:"deactivate",value:function(){m(c(n.prototype),"deactivate",this).call(this),this.brush.deactivate(),this.brush.stopErasing()}}]),n}(Ht),Jt=function(){function t(e,n){i(this,t),this.brush=e,this.renderToolbar=n,this.changeRadius=this.changeRadius.bind(this)}return o(t,[{key:"changeRadius",value:function(t){t.stopPropagation();var e=parseInt(t.target.value);this.brush.radius!=e&&(this.brush.radius=e),this.renderToolbar()}},{key:"render",value:function(){return dt(Yt(),Lt(this.brush.radius,this.changeRadius,{title:"Eraser Size"}))}}]),t}();function Zt(){var t=y(['<img src="','" alt="Pan" \n            style="display: inline-block; height: 24px !important; z-index: 100;"></img>']);return Zt=function(){return t},t}var Wt=function(t){l(n,t);var e=v(n);function n(){i(this,n);var t=dt(Zt(),"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABICAYAAABV7bNHAAABtElEQVR4AezWAWYDURSF4SIIsoCgiwiCIgAUUGQBs4QACugyggK6hCAoAgigKIKiyAIGRTC4/QGlcR6PiTH3HL4N/OOOdzfQTbDBO76xQwPmTXBAXPGG9HtBCA1S7xMh7LKfZBS02U8ySrKfZJTVnOTwN8MKDZaY1gaqOMnB7xFnxB8nLPsPhIFvgU583fvsgfYIYZs9UIsQPrIHirLbBtIPSwfSD0sHKj8skwcqPyyzB4qC1oEKHMiBHMiBHMiBHMiBHKiHOZADOZADOZADOZADDUCSQA7kQA7kQA40caD/m2GLFhfs8QQHYnOcEFccsEgSSMcROrxiniSQjiO0eMY0S6AjosIX1hkCPeAHUemAxdj/QauKSOL/NJ5A9ZHE/2kkgXSkhPQcSc+RCnMkOR3p4kB6a3QO5Eh6jqTnSMU5kp4j6TlST2tGEueM3rYZQaDj7/B7cTSQVoM8MRpIpG+oGw0kaEUjgttLo4HUj9sro4H0HnfqGQ2k3+DjMwYYVA/iwMlmGCQgfDCNTELd4s0wyIAKEK8fBKlmPvhglUEMdIC4Gdpy/UynLsRh6FydCrGOBABk1k0h3bUPJgAAAABJRU5ErkJggg==");return e.call(this,"pan","Pan",t)}return n}(Ht);var Xt=function(t){l(n,t);var e=v(n);function n(t,r,o){var s;return i(this,n),(s=e.call(this,t,r)).color=o,s.coloring=!1,s.locked=!1,s.listeners={colorend:[],colorfeature:[],mouseup:[]},S(["onMouseDown","onMouseUp","onClick","onTouchStart"],f(s)),s}return o(n,[{key:"setColor",value:function(t){this.color=parseInt(t)}},{key:"startErasing",value:function(){this._previousColor=this.color,this.color=null,this.erasing=!0}},{key:"stopErasing",value:function(){this.color=this._previousColor,this.erasing=!1}},{key:"hoverOn",value:function(t){this.hoveredFeatures=t,!0===this.coloring?this.colorFeatures():m(c(n.prototype),"hoverOn",this).call(this,t)}},{key:"colorFeatures",value:function(){var t=this;this.locked&&!this.erasing?this._colorFeatures((function(t){return null===t.state.color||void 0===t.state.color})):this._colorFeatures((function(e){return e.state.color!==t.color}))}},{key:"_colorFeatures",value:function(t){var e,n=new Set,i=k(this.hoveredFeatures);try{for(i.s();!(e=i.n()).done;){var r=e.value;if(t(r)&&!r.state.home){if(!n.has(r.id)){n.add(r.id);var o,s=k(this.listeners.colorfeature);try{for(s.s();!(o=s.n()).done;){(0,o.value)(r,this.color)}}catch(t){s.e(t)}finally{s.f()}}this.layer.setFeatureState(r.id,u(u({},r.state),{},{color:this.color,hover:!0})),r.state.color=this.color}else this.layer.setFeatureState(r.id,u(u({},r.state),{},{hover:!0}))}}catch(t){i.e(t)}finally{i.f()}var a,l=k(this.listeners.colorend);try{for(l.s();!(a=l.n()).done;){(0,a.value)()}}catch(t){l.e(t)}finally{l.f()}}},{key:"onClick",value:function(){this.colorFeatures()}},{key:"onMouseDown",value:function(t){t.preventDefault(),this.coloring=!0,window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("touchend",this.onMouseUp),window.addEventListener("touchcancel",this.onMouseUp),document.body.classList.add("stop-scrolling")}},{key:"onMouseUp",value:function(){this.coloring=!1,window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("touchend",this.onMouseUp),window.removeEventListener("touchcancel",this.onMouseUp),document.body.classList.remove("stop-scrolling");var t,e=k(this.listeners.mouseup);try{for(e.s();!(t=e.n()).done;){(0,t.value)()}}catch(t){e.e(t)}finally{e.f()}}},{key:"onTouchStart",value:function(t){t.points&&t.points.length<=1&&this.onMouseDown(t)}},{key:"activate",value:function(){this.layer.map.getCanvas().classList.add("brush-tool"),m(c(n.prototype),"activate",this).call(this),this.layer.map.dragPan.disable(),this.layer.map.touchZoomRotate.disable(),this.layer.map.doubleClickZoom.disable(),this.layer.on("click",this.onClick),this.layer.map.on("touchstart",this.onTouchStart),this.layer.map.on("mousedown",this.onMouseDown)}},{key:"deactivate",value:function(){this.layer.map.getCanvas().classList.remove("brush-tool"),m(c(n.prototype),"deactivate",this).call(this),this.layer.map.dragPan.enable(),this.layer.map.doubleClickZoom.enable(),this.layer.map.touchZoomRotate.enable(),this.layer.off("click",this.onClick),this.layer.map.off("touchstart",this.onTouchStart),this.layer.map.off("mousedown",this.onMouseDown)}},{key:"on",value:function(t,e){this.listeners[t].push(e)}}]),n}(function(t){l(n,t);var e=v(n);function n(t,r){var o;return i(this,n),(o=e.call(this,t)).radius=r,o.hoveredFeatures=[],o}return o(n,[{key:"hoverOff",value:function(){var t=this;this.hoveredFeatures.forEach((function(e){t.layer.setFeatureState(e.id,u(u({},e.state),{},{hover:!1}))})),this.hoveredFeatures=[]}},{key:"hoverOn",value:function(t){var e=this;this.hoveredFeatures=t,this.hoveredFeatures.forEach((function(t){e.layer.setFeatureState(t.id,u(u({},t.state),{},{hover:!0}))}))}},{key:"onMouseMove",value:function(t){var e,n,i,r=(e=t.point,n=this.radius,i=[e.x+n,e.y+n],[[e.x-n,e.y-n],i]),o=this.layer.map.queryRenderedFeatures(r,{layers:[this.layer.id]});o.length>0&&(this.hoverOff(),this.hoverOn(o))}}]),n}(function(){function t(e){i(this,t),this.layer=e,this.hoveredFeature=null,this.onMouseMove=this.onMouseMove.bind(this),this.onMouseLeave=this.onMouseLeave.bind(this),this.hoverOff=this.hoverOff.bind(this)}return o(t,[{key:"hoverOff",value:function(){null!==this.hoveredFeature&&(this.layer.setFeatureState(this.hoveredFeature.id,u(u({},this.hoveredFeature.state),{},{hover:!1})),this.hoveredFeature=null)}},{key:"hoverOn",value:function(t){this.hoveredFeature=t,this.layer.setFeatureState(t.id,u(u({},t.state),{},{hover:!0}))}},{key:"onMouseMove",value:function(t){t.features.length>0&&(this.hoverOff(),this.hoverOn(t.features[0]))}},{key:"onMouseLeave",value:function(){this.hoverOff()}},{key:"activate",value:function(){this.layer.on("mousemove",this.onMouseMove),this.layer.on("mouseleave",this.onMouseLeave),this.layer.on("touchmove",this.onMouseMove,{passive:!1}),this.layer.on("touchend",this.onMouseLeave)}},{key:"deactivate",value:function(){this.layer.off("mousemove",this.onMouseMove),this.layer.off("mouseleave",this.onMouseLeave),this.layer.off("touchmove",this.onMouseMove),this.layer.off("touchend",this.onMouseLeave)}}]),t}()));var qt,$t=function(){function t(e,n){i(this,t),this.reducer=e,this.state=n,this.subscribers=[],S(["dispatch","subscribe"],this)}return o(t,[{key:"dispatch",value:function(t){var e=this,n=this.reducer(this.state,t);n!==this.state&&(this.state=n,this.subscribers.forEach((function(t){return t(e.state,e.dispatch)})))}},{key:"subscribe",value:function(t){this.subscribers.push(t)}}]),t}(),te=function(t,e){var n=t.startNode.parentNode,i=void 0===e?t.endNode:e.startNode,r=n.insertBefore(Y(),i);n.insertBefore(Y(),i);var o=new tt(t.options);return o.insertAfterNode(r),o},ee=function(t,e){return t.setValue(e),t.commit(),t},ne=function(t,e,n){var i=t.startNode.parentNode,r=n?n.startNode:t.endNode,o=e.endNode.nextSibling;o!==r&&function(t,e){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;e!==n;){var r=e.nextSibling;t.insertBefore(e,i),e=r}}(i,e.startNode,o,r)},ie=function(t){C(t.startNode.parentNode,t.startNode,t.endNode.nextSibling)},re=function(t,e,n){for(var i=new Map,r=e;r<=n;r++)i.set(t[r],r);return i},oe=new WeakMap,se=new WeakMap,ae=(qt=function(t,e,n){var i;return void 0===n?n=e:void 0!==e&&(i=e),function(e){if(!(e instanceof tt))throw new Error("repeat can only be used in text bindings");var r,o,s,a=oe.get(e)||[],u=se.get(e)||[],l=[],c=[],h=[],d=0,f=k(t);try{for(f.s();!(r=f.n()).done;){var p=r.value;h[d]=i?i(p,d):d,c[d]=n(p,d),d++}}catch(t){f.e(t)}finally{f.f()}for(var v=0,m=a.length-1,y=0,g=c.length-1;v<=m&&y<=g;)if(null===a[v])v++;else if(null===a[m])m--;else if(u[v]===h[y])l[y]=ee(a[v],c[y]),v++,y++;else if(u[m]===h[g])l[g]=ee(a[m],c[g]),m--,g--;else if(u[v]===h[g])l[g]=ee(a[v],c[g]),ne(e,a[v],l[g+1]),v++,g--;else if(u[m]===h[y])l[y]=ee(a[m],c[y]),ne(e,a[m],a[v]),m--,y++;else if(void 0===o&&(o=re(h,y,g),s=re(u,v,m)),o.has(u[v]))if(o.has(u[m])){var b=s.get(h[y]),A=void 0!==b?a[b]:null;if(null===A){var w=te(e,a[v]);ee(w,c[y]),l[y]=w}else l[y]=ee(A,c[y]),ne(e,A,a[v]),a[b]=null;y++}else ie(a[m]),m--;else ie(a[v]),v++;for(;y<=g;){var _=te(e,l[g+1]);ee(_,c[y]),l[y++]=_}for(;v<=m;){var x=a[v++];null!==x&&ie(x)}oe.set(e,l),se.set(e,h)}},function(){var t=qt.apply(void 0,arguments);return B.set(t,!0),t});function ue(){var t=y(['\n    <section\n        class="tool-options ','"\n    >\n        ',"\n    </section>\n"]);return ue=function(){return t},t}function le(){var t=y(['\n        <div class="districtr__mini-toolbar">\n            <nav>\n                <div class="districtr__mini-toolbar-top">\n                    <div class="icon-list">\n                        ',"\n                    </div>\n                </div>\n            </nav>\n            ","\n            </div>\n        </div>\n        "]);return le=function(){return t},t}var ce=function(){function t(e,n){i(this,t),this.tools=[],this.toolsById={},this.menuItems=[],this.renderCallback=n.render,this.render=this.render.bind(this),this.selectTool=this.selectTool.bind(this),this.addTool=this.addTool.bind(this),this.store=e}return o(t,[{key:"selectTool",value:function(t){this.activeTool&&this.activeTool.deactivate(),this.toolsById[t].activate(),this.store.dispatch(P.selectTool({id:t}))}},{key:"addTool",value:function(t){void 0!==t.options&&(t.options.renderToolbar=this.renderCallback),this.toolsById[t.id]=t,this.tools.push(t)}},{key:"setMenuItems",value:function(t){this.menuItems=t}},{key:"render",value:function(){var t,e=this;return dt(le(),ae(this.tools,(function(t){return t.id}),(function(t){return t.render(e.selectTool)})),(t=this.activeTool,dt(ue(),void 0!==t.options?"active":"",void 0!==t.options?t.options.render():"")))}},{key:"activeTool",get:function(){return this.toolsById[this.store.state.toolbar.activeTool]}}]),t}();function he(){var t=y(["<h4>An error occurred.</h4>"]);return he=function(){return t},t}var de=[function(t){var e=t.state,n=t.toolbar,i=new Xt(e.units,10,0);i.on("colorfeature",e.update),i.on("colorend",e.render);for(var r=0,o=[new Wt,new Qt(i,e.parts),new Kt(i)];r<o.length;r++){var s=o[r];n.addTool(s)}n.selectTool("brush")}],fe=function(){function t(n,r,o){var s=this;i(this,t),this.render=this.render.bind(this),e.accessToken=r.token,o=u({style:"mapbox://styles/mapbox/outdoors-v11"},o);var a=document.querySelector(n);a.classList.add("districtr__embed-container");var l=document.createElement("div"),c=M(8);l.setAttribute("id",c),l.style="height: 100%; width: 100%",a.appendChild(l),this.toolbarTarget=document.createElement("div"),a.appendChild(this.toolbarTarget),this.addressMarker=null,this.graph=null,this.showError=r.errors,this.allowProceed=r.allowProceed,fetch(r.graph).then((function(t){return t.json()})).then((function(t){s.graph=t})),fetch(r.url).then((function(t){return t.json()})).then((function(t){s.bounds=t.units.bounds,s.zoomTo=t.units.zoomTo||14,s.mapState=new wt(c,{bounds:t.units.bounds,fitBoundsOptions:{padding:{top:50,right:50,left:50,bottom:50}}},o.style),s.mapState.map.on("load",(function(){s.state=new Ct(s.mapState.map,t,(function(){return null})),s.enableMap=function(){if(!this.enabled){this.enabled=!0,this.store=new $t(V,{toolbar:{}}),this.toolbar=new ce(this.store,this);var t,e=k(de);try{for(e.s();!(t=e.n()).done;){(0,t.value)(this)}}catch(t){e.e(t)}finally{e.f()}this.store.subscribe(this.render),this.state.subscribe(this.render);var n=document.createElement("div");n.id="ns__msg-draw",n.className="ns__msg",n.style.margin="0",n.style.borderRadius="0",n.hidden=!0,this.toolbarTarget.prepend(n);var i=-1,r=this.checkConnected.bind(this,n);this.toolbar.toolsById.brush.brush.on("mouseup",(function(){window.clearTimeout(i),i=window.setTimeout(r,50)}))}},s.enabled=!1}))})).catch((function(t){console.error(t),ht(dt(he()),a)}))}return o(t,[{key:"render",value:function(){this.toolbarTarget&&this.toolbar&&ht(this.toolbar.render(),this.toolbarTarget)}},{key:"checkConnected",value:function(t){var e=this.graph;if(!e)return null;var n=this.state.plan.assignment,i={},r=0;for(var o in n)0==n[o]&&(i[o]=!1,r++);var s=function t(n,i){var r=1;n[i]=!0;var o,s=k(e[i]);try{for(s.s();!(o=s.n()).done;){var a=o.value;!1===n[a]&&(r+=t(n,a))}}catch(t){s.e(t)}finally{s.f()}return r}(i,this.homeBlock.id)===r;return s?(t.hidden=!0,t.innerHTML=null):(t.hidden=!1,t.innerHTML="Your neighborhood must be in one piece only."),this.allowProceed(s),s}},{key:"loadAddress",value:function(t){var n=this,i="https://api.mapbox.com/geocoding/v5/mapbox.places/".concat(encodeURIComponent(t),".json")+"?autocomplete=false&limit=1&bbox="+this.bounds[0][0]+","+this.bounds[0][1]+","+this.bounds[1][0]+","+this.bounds[1][1]+"&access_token=".concat(e.accessToken);fetch(i).then((function(t){return t.json()})).then((function(t){if(0!=t.features.length){n.showError(null),n.enableMap();var i=t.features[0].center;n.addressMarker&&n.addressMarker.remove(),n.addressMarker=new e.Marker({color:"#ff4f49"}).setLngLat(i).addTo(n.map);var r=function(){var t=this.map.queryRenderedFeatures(this.map.project(i),{layers:[this.state.units.id],validate:!1})[0];t?(t.state.home=!0,this.homeBlock&&this.map.setFeatureState(this.homeBlock,u(u({},this.homeBlock.state),{},{home:!1})),this.state.units.setAssignment(t,0),this.state.plan.assignment[t.id]=0,this.homeBlock=t):setTimeout(r,250)}.bind(n);n.map.once("moveend",(function(){setTimeout(r,250)})),n.map.easeTo({center:i,zoom:n.zoomTo})}else n.showError("Address not found.")}))}},{key:"getNeighborhood",value:function(){var t=this.state.plan.assignment;return Object.keys(t).filter((function(e){return 0==t[e]})).join(",")}},{key:"map",get:function(){return this.mapState.map}}]),t}();window.MapDraw=function(t,e,n){return new fe(t,e,n)},window.showError=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#ns__msg-search",n=document.querySelector(e);null!==t?(n.hidden=!1,n.innerHTML=t):(n.hidden=!0,n.innerHTML="&nbsp;")},t.EmbeddedDistrictr=fe,Object.defineProperty(t,"__esModule",{value:!0})}));
